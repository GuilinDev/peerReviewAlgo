# 1. 数据持久化层场景
## 1.1 冷热分离 Hot Warm (Hot Cold) Architecture
场景：供应链有个订单功能，里面的主表有几千万的数据量，加上关联表，数据量达到上亿，这么庞大的数据量，让平台的订单查询非常缓慢（查询一次需要二三十秒），多点几次还会出现宕机。比如业务员多次查询时，数据库的CPU会立即狂飙，服务器的线程数也降不下来。

Initiative的解决方案：优化表结构，优化业务代码，添加索引，优化SQL语句等，但查询速度还是很慢。

性价比高的解决方案：简单方便地解决了这个问题。在处理数据时，将数据库分成了冷库和热库 2 个库，不常用数据放冷库，常用数据放热库。通过这样的方法处理后，因为业务员查询的基本是近期常用的数据，常用的数据量大大减少了，就再也不会出现宕机的情况了，也大大提升了数据库响应速度。

> 冷热分离就是在处理数据时将数据库分成冷库和热库 2 个库，冷库指存放那些走到了终态的数据的数据库，热库指存放还需要修改的数据的数据库。

假设你务需求出现了如下情况，就可以考虑使用冷热分离的解决方案：
* 数据走到终态后，只有读没有写的需求，比如订单完结状态；
* 用户能接受新旧数据分开查询，比如有些电商网站默认只让查询 3 个月内的订单，如果你要查询 3 个月前的订单，还需要访问另外的单独页面。

在实际操作过程中，冷热分离整体实现思路如下：

（一）如何判断一个数据到底是冷数据还是热数据？ - 主要采用主表里的 1 个或多个字段组合的方式作为区分标识（时间维度/状态维度/组合维度）。

* 如果一个数据被标识为冷数据，业务代码不会再对它进行写操作；
* 不会同时存在读冷/热数据的需求。

（二）如何触发冷热数据分离？
* 直接修改业务代码，每次修改数据时触发冷热分离（比如每次更新了订单的状态，就去触发这个逻辑）
* 如果不想修改原来的业务代码，可通过监听数据库变更日志 binlog 的方式（订阅消费）来触发
* 通过定时扫描数据库的方式来触发

（三）如何实现冷热数据分离？

（四）如何使用冷热数据？

# 2. 缓存层场景


# 3. 微服务场景常见组件


# 4. 微服务的坑


# 5. 微服务进阶


# 6. DEVOPS场景
